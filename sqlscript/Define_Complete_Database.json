{
	"name": "Define_Complete_Database",
	"properties": {
		"description": "using scoped credentials and a master key",
		"folder": {
			"name": "DE-Boot-Camp/DeProject2"
		},
		"content": {
			"query": "\n-- create master key / database scoped credential\nCREATE DATABASE sqltips\n \n-- Drop if required\nDROP MASTER KEY;\nGO\n \n-------Create master key\nCREATE MASTER KEY ENCRYPTION BY PASSWORD='AcEADre5eHJvEcWFhUf8';\nGO\n \n-- -----Drop if required\n--DROP DATABASE SCOPED CREDENTIAL LakeCredential;\n--GO\n \n-- Create a database scoped credential.\nCREATE DATABASE SCOPED CREDENTIAL LakeCredential\nWITH IDENTITY = 'SHARED ACCESS SIGNATURE',\nSECRET = 'sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupyx&se=2025-06-07T09:35:12Z&st=2025-05-28T01:35:12Z&spr=https,http&sig=8PqoGNc40FAabE9ZKbCL7LUR%2BYUUYPm%2FySr2bK%2Bxo%2BA%3D';\n \n-- Show credentials\nSELECT NAME FROM sys.database_scoped_credentials;\nGO\n\n--\n-- 7 - create data source\n--\n \n-- Drop if required\n\n\n--DROP EXTERNAL DATA SOURCE LakeDataSource;\n--GO\n \n-- Create if required\nCREATE EXTERNAL DATA SOURCE LakeDataSource\nWITH\n(\n   LOCATION = 'https://satestdebc.blob.core.windows.net/synapse',\n   CREDENTIAL = LakeCredential\n)\nGO\n \n-- Show data sources\nSELECT * FROM sys.external_data_sources;\nGO\n\n\n-- 8 - create data source\nCREATE SCHEMA [saleslt];\nGO\n\n--\n--- create table â€“ currency using the parquetfiles\n--\n CREATE EXTERNAL FILE FORMAT ParquetFile\nWITH (\n    FORMAT_TYPE = PARQUET\n);\nGO\n\n\nCREATE EXTERNAL FILE FORMAT DelimitedFile\nWITH (\n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS\n        ( FIELD_TERMINATOR ='|',\n          USE_TYPE_DEFAULT = FALSE\n        )\n);\nGO\n\n\n-- Drop if required\nDROP EXTERNAL TABLE [saleslt].[dim_Product_category]\nGO\n \n-- Create table\nDROP EXTERNAL TABLE [saleslt].[dim_currency]\nGO\n \n-- Create table\n\nCREATE EXTERNAL TABLE [saleslt].[dim_currency]\n(\n   [CurrencyKey] [int],\n   [CurrencyAlternateKey] [nvarchar](3),\n   [CurrencyName] [nvarchar](50)\n)\nWITH\n(\n   LOCATION = '/parquet-files/DimCurrency.parquet',\n   DATA_SOURCE = [LakeDataSource],\n   FILE_FORMAT = [ParquetFile]\n)\nGO\n\nSELECT * FROM [saleslt].[dim_currency]\n\n\nCREATE EXTERNAL TABLE [saleslt].[dim_Geography]\n(\n\t[GeographyKey] [int] ,\n\t[City] [nvarchar](30) ,\n\t[StateProvinceCode] [nvarchar](3) ,\n\t[StateProvinceName] [nvarchar](50) ,\n\t[CountryRegionCode] [nvarchar](3) ,\n\t[EnglishCountryRegionName] [nvarchar](50) ,\n\t[SpanishCountryRegionName] [nvarchar](50) ,\n\t[FrenchCountryRegionName] [nvarchar](50) ,\n\t[PostalCode] [nvarchar](15) ,\n\t[SalesTerritoryKey] [int] ,\n\t[IpAddressLocator] [nvarchar](15) )\n\nWITH\n(\n   LOCATION = '/parquet-files/DimGeography.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n)\nGO\n \n-- Show data\nSELECT * FROM saleslt.dim_Geography;\nGO\nDROP EXTERNAL TABLE [saleslt].dim_Customer\n\nCREATE EXTERNAL TABLE [saleslt].[dim_Customer]\n(\n\t[CustomerKey] [int],\n\t[GeographyKey] [int],\n\t[CustomerAlternateKey] [nvarchar](15),\n\t[Title] [nvarchar](8),\n\t[FirstName] [nvarchar](50),\n\t[MiddleName] [nvarchar](50),\n\t[LastName] [nvarchar](50),\n\t[NameStyle] [int],\n\t[BirthDate] [date],\n\t[MaritalStatus] [nchar](1),\n\t[Suffix] [nvarchar](10),\n\t[Gender] [nvarchar](1),\n\t[EmailAddress] [nvarchar](50),\n\t[YearlyIncome] [money],\n\t[TotalChildren] [tinyint],\n\t[NumberChildrenAtHome] [tinyint],\n\t[EnglishEducation] [nvarchar](40),\n\t[SpanishEducation] [nvarchar](40),\n\t[FrenchEducation] [nvarchar](40),\n\t[EnglishOccupation] [nvarchar](100),\n\t[SpanishOccupation] [nvarchar](100),\n\t[FrenchOccupation] [nvarchar](100),\n\t[HouseOwnerFlag] [nchar](1),\n\t[NumberCarsOwned] [tinyint],\n\t[AddressLine1] [nvarchar](120),\n\t[AddressLine2] [nvarchar](120),\n\t[Phone] [nvarchar](20),\n\t[DateFirstPurchase] [date],\n\t[CommuteDistance] [nvarchar](15) \n)\n   WITH\n(\n   LOCATION = '/parquet-files/DimCustomer.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n)\nGO\n\n-- Show data\nSELECT TOP 5 * FROM [saleslt].[dim_Customer];\nGO\n\nCREATE EXTERNAL TABLE [saleslt].[Dim_Product_Category]\n(\n\t[ProductCategoryKey] [int],\n\t[ProductCategoryAlternateKey] [int],\n\t[EnglishProductCategoryName] [nvarchar](50),\n\t[SpanishProductCategoryName] [nvarchar](50),\n\t[FrenchProductCategoryName] [nvarchar](50),\n)\n   WITH\n(\n   LOCATION = '/parquet-files/DimProductCategory/DimProductCategory.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n);\nGO\n\nCREATE EXTERNAL TABLE [saleslt].[Dim_Date]\n(\n\t[DateKey] [int] ,\n\t[FullDateAlternateKey] [date],\n\t[DayNumberOfWeek] [tinyint],\n\t[EnglishDayNameOfWeek] [nvarchar](10),\n\t[SpanishDayNameOfWeek] [nvarchar](10),\n\t[FrenchDayNameOfWeek] [nvarchar](10),\n\t[DayNumberOfMonth] [tinyint],\n\t[DayNumberOfYear] [smallint],\n\t[WeekNumberOfYear] [tinyint],\n\t[EnglishMonthName] [nvarchar](10),\n\t[SpanishMonthName] [nvarchar](10),\n\t[FrenchMonthName] [nvarchar](10),\n\t[MonthNumberOfYear] [tinyint],\n\t[CalendarQuarter] [tinyint],\n\t[CalendarYear] [smallint],\n\t[CalendarSemester] [tinyint],\n\t[FiscalQuarter] [tinyint],\n\t[FiscalYear] [smallint],\n\t[FiscalSemester] [tinyint]\n)\n   WITH\n(\n   LOCATION = '/parquet-files/DimDate.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n);\nGO\n\nCREATE EXTERNAL TABLE [saleslt].[Dim_Product](\n\t[ProductKey] [int],\n\t[ProductAlternateKey] [nvarchar](25),\n\t[ProductSubcategoryKey] [int],\n\t[WeightUnitMeasureCode] [nchar](3),\n\t[SizeUnitMeasureCode] [nchar](3),\n\t[EnglishProductName] [nvarchar](50),\n\t[SpanishProductName] [nvarchar](50),\n\t[FrenchProductName] [nvarchar](50),\n\t[StandardCost] [money],\n\t[FinishedGoodsFlag] [bit],\n\t[Color] [nvarchar](15),\n\t[SafetyStockLevel] [smallint],\n\t[ReorderPoint] [smallint],\n\t[ListPrice] [money],\n\t[Size] [nvarchar](50),\n\t[SizeRange] [nvarchar](50),\n\t[Weight] [float],\n\t[DaysToManufacture] [int],\n\t[ProductLine] [nchar](2),\n\t[DealerPrice] [money],\n\t[Class] [nchar](2),\n\t[Style] [nchar](2),\n\t[ModelName] [nvarchar](50),\n\t[LargePhoto] [varbinary](max),\n\t[EnglishDescription] [nvarchar](400),\n\t[FrenchDescription] [nvarchar](400),\n\t[ChineseDescription] [nvarchar](400),\n\t[ArabicDescription] [nvarchar](400),\n\t[HebrewDescription] [nvarchar](400),\n\t[ThaiDescription] [nvarchar](400),\n\t[GermanDescription] [nvarchar](400),\n\t[JapaneseDescription] [nvarchar](400),\n\t[TurkishDescription] [nvarchar](400),\n\t[StartDate] [datetime],\n\t[EndDate] [datetime],\n\t[Status] [nvarchar](7)\n)\n\t   WITH\n(\n   LOCATION = '/parquet-files/DimProduct.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n);\nGO\n\nCREATE EXTERNAL TABLE [saleslt].[Dim_Product_Subcategory]\n(\n\t[ProductSubcategoryKey] [int],\n\t[ProductSubcategoryAlternateKey] [int],\n\t[EnglishProductSubcategoryName] [nvarchar](50),\n\t[SpanishProductSubcategoryName] [nvarchar](50),\n\t[FrenchProductSubcategoryName] [nvarchar](50),\n\t[ProductCategoryKey] [int]\n)\n\t  WITH\n(\n   LOCATION = '/parquet-files/DimProductSubcategory.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n);\nGO\n\nCREATE EXTERNAL TABLE [saleslt].[Dim_Sales_Reason]\n(\n\t[SalesReasonKey] [int],\n\t[SalesReasonAlternateKey] [int],\n\t[SalesReasonName] [nvarchar](50),\n\t[SalesReasonReasonType] [nvarchar](50)\n)\n\t WITH\n(\n   LOCATION = '/parquet-files/DimSalesReason.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n);\nGO\n\n\nCREATE EXTERNAL TABLE [saleslt].[Dim_Sales_Territory]\n(\n\t[SalesTerritoryKey] [int],\n\t[SalesTerritoryAlternateKey] [int],\n\t[SalesTerritoryRegion] [nvarchar](50),\n\t[SalesTerritoryCountry] [nvarchar](50),\n\t[SalesTerritoryGroup] [nvarchar](50),\n\t[SalesTerritoryImage] [varbinary](max)\n)\n    WITH\n(\n   LOCATION = '/parquet-files/DimSalesTerritory.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n);\nGO\n\nCREATE EXTERNAL TABLE [saleslt].[Fact_Internet_Sales_Reason]\n(\n\t[SalesOrderNumber] [nvarchar](20),\n\t[SalesOrderLineNumber] [tinyint],\n\t[SalesReasonKey] [int]\n)\n   WITH\n(\n   LOCATION = '/parquet-files/FactInternetSalesReason.parquet',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n);\nGO\n\nCREATE EXTERNAL TABLE [saleslt].[fact_internet_sales]\n(\n   [ProductKey] [int],\n   [OrderDateKey] [int],\n   [DueDateKey] [int],\n   [ShipDateKey] [int],\n   [CustomerKey] [int],\n   [PromotionKey] [int],\n   [CurrencyKey] [int],\n   [SalesTerritoryKey] [int],\n   [SalesOrderNumber] [nvarchar](20),\n   [SalesOrderLineNumber] [tinyint],\n   [RevisionNumber] [tinyint],\n   [OrderQuantity] [smallint],\n   [UnitPrice] [money],\n   [ExtendedAmount] [money],\n   [UnitPriceDiscountPct] DECIMAL(19, 4),\n   [DiscountAmount] DECIMAL(19, 4),\n   [ProductStandardCost] [money],\n   [TotalProductCost] [money],\n   [SalesAmount] [money],\n   [TaxAmt] [money],\n   [Freight] [money],\n   [CarrierTrackingNumber] [nvarchar](25),\n   [CustomerPONumber] [nvarchar](25),\n   [OrderDate] [datetime],\n   [DueDate] [datetime],\n   [ShipDate] [datetime]\n)\nWITH\n(\n   LOCATION = '/parquet-files/FactInternetSales/**',\n   DATA_SOURCE = LakeDataSource,\n   FILE_FORMAT = ParquetFile\n)\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "sqltips",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}